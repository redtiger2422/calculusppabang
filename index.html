<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>íƒ€ìš” & í‹°ë‹ˆí•‘ ìˆ˜í•™ ëª¨í—˜</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: linear-gradient(120deg, #a1e0ff 40%, #f9e0ff 100%);
      box-sizing: border-box;
      font-family: 'Spoqa Han Sans Neo', 'Noto Sans KR', Arial, sans-serif;
    }
    body {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    #openingVideo {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    #openingVideo video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    #openingVideoPlayer {
      width: 100%;
      height: 100%;
      max-width: 1280px;
      max-height: 720px;
    }
    
    #skipButton {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.8);
      color: #333;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      z-index: 1001;
      transition: background 0.3s;
    }
    
    #skipButton:hover {
      background: rgba(255, 255, 255, 0.95);
    }
    
    #soundButton {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(102, 181, 246, 0.9);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      z-index: 1001;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    
    #soundButton:hover {
      background: rgba(61, 151, 224, 0.95);
      transform: translateX(-50%) scale(1.05);
    }
    
    /* ì¶•í•˜ ë©”ì‹œì§€ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    #congratsModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    
    #congratsBox {
      background: linear-gradient(135deg, #fff 0%, #ffd6f3 100%);
      border-radius: 25px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
      animation: bounceIn 0.6s ease-out;
      max-width: 90%;
      width: 450px;
    }
    
    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    #congratsMessage {
      font-size: 26px;
      font-weight: bold;
      color: #ff1493;
      margin-bottom: 30px;
      line-height: 1.5;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    #giftButton {
      background: linear-gradient(45deg, #ff6b6b, #ff8e53);
      color: white;
      font-size: 20px;
      font-weight: bold;
      padding: 15px 40px;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    #giftButton:hover {
      background: linear-gradient(45deg, #ff5252, #ff7043);
      transform: scale(1.1);
      box-shadow: 0 8px 30px rgba(255, 107, 107, 0.6);
    }
    
    .gift-emoji {
      font-size: 50px;
      margin: 20px 0;
      animation: rotate 3s linear infinite;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    /* ì¶•í•˜ ë¹„ë””ì˜¤ ìŠ¤íƒ€ì¼ */
    #celebrationVideo {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    #celebrationPlayer {
      width: 100%;
      height: 100%;
      max-width: 1280px;
      max-height: 720px;
    }
    
    .celebration-text {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #FFD700;
      font-size: 28px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      animation: sparkle 1.5s ease-in-out infinite;
    }
    
    @keyframes sparkle {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    #closeVideoBtn {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 100, 100, 0.9);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      z-index: 1001;
      transition: all 0.3s;
    }
    
    #closeVideoBtn:hover {
      background: rgba(255, 50, 50, 0.95);
      transform: translateX(-50%) scale(1.05);
    }
    
    #gameContainer {
      width: 100%;
      height: 100%;
      display: none;
      justify-content: center;
      align-items: center;
    }
    
    #gameBox {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      box-shadow: 0 6px 40px rgba(20,60,160,0.17);
      padding: 32px 24px 20px 24px;
      max-width: 420px;
      min-width: 330px;
      width: 90vw;
      margin: 0 auto;
      position: relative;
      text-align: center;
    }
    #logoImages {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 10px;
      margin-bottom: 12px;
    }
    .logo-char {
      height: 60px;
      border-radius: 10px;
      object-fit: contain;
      box-shadow: 0 3px 15px rgba(30,70,180,0.11);
      background: #eaf6ff;
      padding: 3px;
    }
    #adventureMsg {
      margin-bottom: 12px;
    }
    #adventureMsg div {
      color: #3186eb;
      font-size: 1.32em;
      font-weight: bold;
      letter-spacing: 1px;
      text-shadow: 0 1px 5px #fff6;
      animation: bounce 2.2s infinite;
      margin: 4px 0;
    }
    @keyframes bounce {
      0% { transform: translateY(0); }
      15% { transform: translateY(-6px); }
      30% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
      70% { transform: translateY(0); }
    }
    label, select, button, input {
      font-size: 1.15em;
    }
    select, input {
      padding: 7px 12px;
      border-radius: 6px;
      border: 1.2px solid #aad3fd;
      margin-bottom: 12px;
      width: 70%;
      max-width: 200px;
      background: #f5fbff;
    }
    button {
      margin-top: 5px;
      background: #66b5f6;
      color: white;
      font-weight: bold;
      padding: 8px 24px;
      border: none;
      border-radius: 7px;
      cursor: pointer;
      box-shadow: 0 2px 7px #88c6fc55;
      transition: background 0.2s;
    }
    button:hover { background: #3d97e0; }
    #questionNum {
      font-size: 1.07em;
      color: #9791cf;
      margin-bottom: 5px;
    }
    #questionText {
      font-size: 1.6em;
      font-weight: bold;
      color: #3677b6;
      margin-bottom: 18px;
      margin-top: 0;
    }
    #answerInput {
      text-align: center;
      font-weight: bold;
      letter-spacing: 1px;
    }
    #feedback {
      min-height: 1.1em;
      font-size: 1.13em;
      font-weight: 500;
      margin: 7px 0 0 0;
      color: #fa7e2e;
    }
    #mathTip {
      background: linear-gradient(135deg, #e3f2fd 0%, #f8e8ff 100%);
      border-left: 4px solid #3186eb;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      text-align: left;
      font-size: 0.95em;
      color: #3677b6;
      display: none;
      line-height: 1.4;
    }
    #resultSection {
      margin: 0 0 10px 0;
    }
    #resultSection h2 {
      color: #3a7fbc;
      margin-bottom: 5px;
    }
    #resultMsg {
      font-size: 1.14em;
      margin: 12px 0 8px 0;
      color: #6864e2;
    }
    #madeBy {
      font-size: 0.99em;
      color: #aaa;
      margin-top: 18px;
      letter-spacing: 1.5px;
      text-align: center;
      width: 100%;
      position: relative;
    }
    #muteBtn {
      position: absolute;
      top: 12px;
      right: 16px;
      background: none;
      border: none;
      font-size: 1.45em;
      cursor: pointer;
      z-index: 99;
      color: #3186eb;
      user-select: none;
      padding: 0;
    }
    @media (max-width: 500px) {
      #gameBox {
        min-width: unset;
        padding: 8vw 2vw 5vw 2vw;
      }
      .logo-char {
        height: 44px;
      }
      #muteBtn {
        right: 10px;
        top: 8px;
      }
      #skipButton {
        top: 10px;
        right: 10px;
        padding: 8px 16px;
        font-size: 12px;
      }
      #soundButton, #closeVideoBtn {
        bottom: 10px;
        padding: 10px 20px;
        font-size: 14px;
      }
      .celebration-text {
        font-size: 20px;
      }
      #congratsBox {
        padding: 30px;
        width: 90%;
      }
      #congratsMessage {
        font-size: 20px;
      }
      #giftButton {
        font-size: 16px;
        padding: 12px 30px;
      }
      .gift-emoji {
        font-size: 40px;
      }
      #mathTip {
        font-size: 0.9em;
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- ì˜¤í”„ë‹ ë¹„ë””ì˜¤ ì„¹ì…˜ -->
  <div id="openingVideo">
    <video id="openingVideoPlayer" autoplay>
      <source src="openvd.mp4" type="video/mp4">
      ë¸Œë¼ìš°ì €ê°€ ë¹„ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </video>
    <button id="skipButton">ê±´ë„ˆë›°ê¸°</button>
  </div>

  <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
  <div id="gameContainer" style="display: none;">
    <div id="gameBox">
      <button id="muteBtn" title="ìŒì†Œê±° ì „í™˜">ğŸ”Š</button>
      <div id="logoImages">
        <img src="í‹°ë‹ˆí•‘ê³µì£¼.png" alt="í‹°ë‹ˆí•‘ê³µì£¼" class="logo-char" onerror="this.style.display='none'">
        <img src="íƒ€ìš”ìë™ì°¨.png" alt="íƒ€ìš”ìë™ì°¨" class="logo-char" onerror="this.style.display='none'">
      </div>
      <div id="adventureMsg">
        <div>ğŸ’¡ ì‹ ë‚˜ëŠ” íƒ€ìš”ì™€ í‹°ë‹ˆí•‘ì˜ ìˆ˜í•™ ëª¨í—˜!ğŸ’¡</div>
        <div>ğŸš˜ ì§€ê¸ˆ ë– ë‚˜ìš”! ğŸš˜</div>
      </div>
      <!-- ë‚˜ì´ ì„ íƒ í™”ë©´ -->
      <div id="ageSection">
        <label for="ageSelect">ë‚˜ì´ë¥¼ ì„ íƒí•˜ì„¸ìš” (3ì„¸~13ì„¸):</label><br>
        <select id="ageSelect">
          <option value="">-- ë‚˜ì´ ì„ íƒ --</option>
          <option value="3">3ì„¸</option>
          <option value="4">4ì„¸</option>
          <option value="5">5ì„¸</option><option value="6">6ì„¸</option><option value="7">7ì„¸</option>
          <option value="8">8ì„¸</option><option value="9">9ì„¸</option><option value="10">10ì„¸</option>
          <option value="11">11ì„¸</option><option value="12">12ì„¸</option><option value="13">13ì„¸</option>
        </select>
        <br><button id="startQuizBtn">ëª¨í—˜ ì‹œì‘!</button>
      </div>
      <!-- ë¬¸ì œ í€´ì¦ˆ í™”ë©´ -->
      <div id="quizSection" style="display:none;">
        <div id="questionNum"></div>
        <div id="questionText"></div>
        <input id="answerInput" type="text" autocomplete="off" placeholder="ì •ë‹µì„ ì¨ì£¼ì„¸ìš”!">
        <br><button id="submitAnswerBtn">ì •ë‹µ í™•ì¸</button>
        <div id="feedback"></div>
        <div id="mathTip"></div>
      </div>
      <!-- ê²°ê³¼ í™”ë©´ -->
      <div id="resultSection" style="display:none;">
        <h2>ğŸ‰ ëª¨í—˜ ì™„ë£Œ! ğŸ‰</h2>
        <div>ë§ì¶˜ ê°œìˆ˜: <span id="correctCount"></span> / <span id="totalCount"></span></div>
        <div>ì •ë‹µë¥ : <span id="accuracy"></span>%</div>
        <div id="resultMsg"></div>
        <button id="retryBtn" style="display:none;">ì¬ë„ì „í•˜ê¸°</button>
        <button id="restartBtn">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
      <div id="madeBy">Made by ì í˜¸ì•½ì‚¬</div>
    </div>
  </div>

  <!-- ì¶•í•˜ ë©”ì‹œì§€ ëª¨ë‹¬ -->
  <div id="congratsModal">
    <div id="congratsBox">
      <div class="gift-emoji">ğŸ</div>
      <div id="congratsMessage">
        ì™€ìš°! ìˆ˜í•™ ì²œì¬ì´ì‹ ê°€ìš”!?<br>
        ì¶•í•˜ ì„ ë¬¼ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤~!!
      </div>
      <button id="giftButton">ì„ ë¬¼ë°›ê¸°</button>
    </div>
  </div>

  <!-- ì¶•í•˜ ë¹„ë””ì˜¤ ì„¹ì…˜ -->
  <div id="celebrationVideo">
    <div class="celebration-text">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! 90ì  ì´ìƒ! ğŸ‰</div>
    <iframe id="celebrationPlayer" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
    </iframe>
    <button id="closeVideoBtn">ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  </div>

  <!-- ë°°ê²½ ìŒì•…, íš¨ê³¼ìŒ -->
  <audio id="bgMusic" src="tayo1.mp3" loop></audio>
  <audio id="applauseSound" src="coin.mp3" preload="auto"></audio>
  <audio id="congratsSound" src="ë°•ìˆ˜ì†Œë¦¬1.mp3" preload="auto"></audio>

  <script>
    let quiz = { age: null, questions: [], current: 0, correct: 0, consecutiveCorrect: 0, consecutiveWrong: 0 };
    let applauseCooldown = false;
    let bgMusicStarted = false;
    let isSoundOn = true;

    // ì¶•í•˜ ì˜ìƒ ëª©ë¡
    const celebrationVideos = [
      'yg9vV3_rVI0',
      '5chNiLy9X_A',
      'vE7tGIxzfwo',
      'HbBNNzHVLlA'
    ];

    // ì •ë‹µ ì‹œ ì¶•í•˜ ë©”ì‹œì§€ (ê¸°íšì„œ ë°˜ì˜)
    const correctMessages = [
      "ì •ë‹µ! ì™„ì „ ì²œì¬ ì•„ë‹ˆì•¼? ğŸš",
      "ë§ì•˜ì–´ìš”! í˜¹ì‹œ... í˜¹ì‹œ ë©˜ì‚¬ì‹ ê°€ìš”? ğŸ‘‘", 
      "ëŒ€ë°•! ìˆ˜í•™ ì‹ ë™ ë“±ì¥! ğŸŒŸ",
      "ìš°ì™€! ì§„ì§œ ë˜‘ë˜‘í•˜ë‹¤! ğŸ’",
      "ì™„ë²½í•´! ìˆ˜í•™ ë§ˆë²•ì‚¬ì„¸ìš”? âœ¨",
      "ì©ë‹¤! íƒ€ìš”ë„ ê¹œì§ ë†€ëì–´ìš”! ğŸšŒ",
      "í—~ ì§„ì§œ ëŒ€ë‹¨í•œë°ìš”? ğŸ”¥",
      "ì™€ìš°! ì´ ì •ë„ë©´ ìˆ˜í•™ ì²œì¬! ğŸ§ ",
      "ë©‹ì ¸ìš”! í‹°ë‹ˆí•‘ë„ ë°•ìˆ˜ì³ìš”! ğŸ‘‘",
      "ì •ë‹µ! í˜¹ì‹œ ë¯¸ë˜ì˜ ìˆ˜í•™ì? ğŸ¯",
      "ì§±ì´ì—ìš”! ì™„ì „ ìˆ˜í•™ ê³ ìˆ˜! â­",
      "ì˜¤ë§ˆì´ê°“! ì´ëŸ° ì‹¤ë ¥ì´! ğŸ˜",
      "ëŒ€ë‹¨í•´! ì–´ë¥¸ë„ ëª» í‘¸ëŠ”ë°? ğŸ’ª",
      "ì™€~ ì§„ì§œ ë¨¸ë¦¬ ì¢‹ìœ¼ì‹œë„¤ìš”! ğŸŠ",
      "ì •ë‹µ! ìˆ˜í•™ê³„ì˜ ì‹ ì„±! ğŸŒˆ",
      "í¬ìœ¼~ ì´ ì •ë„ ì‹¤ë ¥ì´ë©´! ğŸˆ",
      "ë†€ë¼ì›Œ! ì§„ì§œ ìˆ˜í•™ ì˜ì¬! ğŸ¨",
      "ë§í˜”ë‹¤! í˜¹ì‹œ ìˆ˜í•™ ì„ ìƒë‹˜? ğŸ“š",
      "ìŒ©í! ì™„ì „ ê¹”ë”í•œ ì •ë‹µ! ğŸª",
      "ì •ë§ êµ¿! ìˆ˜í•™ ë§ˆìŠ¤í„°! ğŸ†"
    ];

    // ì—°ì† ì •ë‹µ ì‹œ íŠ¹ë³„ ë©”ì‹œì§€
    const consecutiveMessages = [
      "ì—°ì† ì •ë‹µ! ì§„ì§œ ë¡¤ëª¨ë¸ì´ì„¸ìš”! ğŸ”¥",
      "ê³„ì† ë§íˆë„¤! ìˆ˜í•™ì˜ ì‹  ê°•ë¦¼! âš¡",
      "ì™€! ì—°íƒ€! ì´ê±´ ì§„ì§œ ì‹¤ë ¥! ğŸ’¥",
      "ìŠ¤íŠ¸ë¼ì´í¬! ë¬´ì‹œë¬´ì‹œí•œ ì‹¤ë ¥! ğŸ¯"
    ];

    // ì–´ë ¤ìš´ ë¬¸ì œ ì •ë‹µ ì‹œ
    const hardCorrectMessages = [
      "ì´ëŸ° ì–´ë ¤ìš´ ê²ƒë„! ì§„ì§œ ëŒ€ë°•! ğŸš€",
      "í—‰! ì´ê±¸ ë§íˆë‹¤ë‹ˆ! ì™„ì „ ì²œì¬! ğŸŒŸ",
      "ì™€ìš°! ì´ ë¬¸ì œëŠ” ì •ë§ ì–´ë ¤ìš´ë°! ğŸ…"
    ];

    // ì˜¤ë‹µ ì‹œ ê²©ë ¤ ë©”ì‹œì§€ (ê¸°íšì„œ ë°˜ì˜)
    const wrongMessages = [
      "ê´œì°®ì•„ìš”! í‹€ë¦¬ëŠ” ê²Œ ë” ë§ì´ ë°°ìš°ëŠ” ê±°ì˜ˆìš”! ğŸ’ª",
      "ì‹¤ìˆ˜ëŠ” ì„±ì¥ì˜ ê³„ë‹¨ì´ì—ìš”! ë‹¤ìŒì—” ë” ì˜í•  ê±°ì˜ˆìš”! ğŸŒ±",
      "ì•„ì‰½! í•˜ì§€ë§Œ í¬ê¸°ëŠ” ê¸ˆë¬¼! í™”ì´íŒ…! ğŸ”¥",
      "ì˜¤ë‹µë„ ì†Œì¤‘í•œ ê²½í—˜! ì¡°ê¸ˆë§Œ ë” ìƒê°í•´ë´ìš”! ğŸ¤”",
      "í‹€ë ¤ë„ ê´œì°®ì•„ìš”! ë°°ìš°ëŠ” ê³¼ì •ì´ë‹ˆê¹Œìš”! ğŸ“š",
      "ì•„ê¹ë‹¤! ì¡°ê¸ˆë§Œ ë” ì§‘ì¤‘í•˜ë©´ ë  ê²ƒ ê°™ì€ë°! ğŸ‘€",
      "ì‹¤ìˆ˜ëŠ” ëˆ„êµ¬ë‚˜ í•´ìš”! ì¤‘ìš”í•œ ê±´ ë‹¤ì‹œ ë„ì „í•˜ëŠ” ê±°! ğŸš€",
      "ê´œì°®ì•„ìš”! ì²œì²œíˆ í•˜ë‚˜ì”© ë°°ì›Œê°€ìš”! ğŸ¢",
      "í‹€ë ¸ì§€ë§Œ ê·¸ë˜ë„ ì—´ì‹¬íˆ í–ˆì–´ìš”! ğŸ‘",
      "ì•„ì‰½ì§€ë§Œ ë‹¤ìŒ ë¬¸ì œì—ì„œ ë§ŒíšŒí•˜ì! ğŸ’«",
      "ì‹¤íŒ¨ëŠ” ì„±ê³µì˜ ì–´ë¨¸ë‹ˆ! ë‹¤ì‹œ í˜ë‚´ìš”! ğŸŒˆ",
      "ê´œì°®ì•„ìš”! ëª¨ë¥´ëŠ” ê±¸ ì•Œê²Œ ëœ ê±°ì–ì•„ìš”! ğŸ’¡",
      "ì˜¤ë‹µ! í•˜ì§€ë§Œ ë°°ì›€ì˜ ê¸°íšŒ! ğŸ¯",
      "í‹€ë ¤ë„ OK! ì¤‘ìš”í•œ ê±´ ëê¹Œì§€ í•˜ëŠ” ê±°! ğŸƒâ€â™‚ï¸",
      "ì•„ì‰½! í•˜ì§€ë§Œ ì ì  ëŠ˜ê³  ìˆì–´ìš”! ğŸ“ˆ"
    ];

    // ì—°ì† ì˜¤ë‹µ ì‹œ íŠ¹ë³„ ê²©ë ¤
    const consecutiveWrongMessages = [
      "ê´œì°®ì•„ìš”! ì–´ë ¤ìš´ ë¬¸ì œê°€ ê³„ì† ë‚˜ì™”ë„¤ìš”! ğŸ˜Š",
      "ì¡°ê¸ˆ ì–´ë µì£ ? ì²œì²œíˆ í•´ë´ìš”! ğŸ•°ï¸",
      "í˜ë“¤ì–´ë„ í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”! ê±°ì˜ ë‹¤ ì™”ì–´ìš”! ğŸˆ"
    ];

    // ëœë¤ í•¨ìˆ˜
    function randInt(min, max) { 
      return Math.floor(Math.random() * (max - min + 1)) + min; 
    }

    // ë°°ì—´ ì…”í”Œ í•¨ìˆ˜
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    // ë‚˜ì´ë³„ ë¬¸ì œ í’€ ìƒì„± í•¨ìˆ˜ (ì¤‘ë³µ ë°©ì§€)
    function generateQuestionPool(age) {
      const pool = [];
      
      if (age === 3) {
        // 3ì„¸: 1~5 ì´í•˜ ìˆ«ìë§Œ - ì •í™•í•œ ë¬¸ì œë“¤
        const addProblems = [
          [1,1], [1,2], [2,1], [2,2], [1,3], [3,1], [2,3], [3,2], [1,4], [4,1]
        ];
        const subProblems = [
          [2,1], [3,1], [3,2], [4,1], [4,2], [4,3], [5,1], [5,2], [5,3], [5,4]
        ];
        
        addProblems.forEach(([a, b]) => {
          pool.push({q: `${a} + ${b}`, a: a + b});
        });
        
        subProblems.forEach(([a, b]) => {
          pool.push({q: `${a} - ${b}`, a: a - b});
        });
        
      } else if (age === 4) {
        // 4ì„¸: 1~5, ë‹µì´ 5 ì´í•˜ ì–‘ìˆ˜
        const addProblems = [
          [1,1], [1,2], [1,3], [1,4], [2,1], [2,2], [2,3], [3,1], [3,2], [4,1], [2,4], [4,2], [3,3]
        ];
        const subProblems = [
          [2,1], [3,1], [3,2], [4,1], [4,2], [4,3], [5,1], [5,2], [5,3], [5,4], [5,5]
        ];
        
        addProblems.forEach(([a, b]) => {
          if (a + b <= 5) {
            pool.push({q: `${a} + ${b}`, a: a + b});
          }
        });
        
        subProblems.forEach(([a, b]) => {
          pool.push({q: `${a} - ${b}`, a: a - b});
        });
        
      } else if (age >= 5 && age <= 6) {
        // 5-6ì„¸: 10 ì´í•˜ í•œ ìë¦¬ ìˆ˜
        for (let x = 1; x <= 9; x++) {
          for (let y = 1; y <= 10 - x; y++) {
            pool.push({q: `${x} + ${y}`, a: x + y});
          }
        }
        
        for (let x = 1; x <= 10; x++) {
          for (let y = 1; y <= x; y++) {
            pool.push({q: `${x} - ${y}`, a: x - y});
          }
        }
        
      } else if (age >= 7 && age <= 8) {
        // 7-8ì„¸: ë°›ì•„ì˜¬ë¦¼/ë°›ì•„ë‚´ë¦¼, í•œ ìë¦¬ ê³±ì…ˆ
        
        // ë°›ì•„ì˜¬ë¦¼ ë§ì…ˆ
        const carryAddPairs = [
          [9,2],[9,3],[9,4],[9,5],[9,6],[9,7],[9,8],[9,9],
          [8,3],[8,4],[8,5],[8,6],[8,7],[8,8],[8,9],
          [7,4],[7,5],[7,6],[7,7],[7,8],[7,9],
          [6,5],[6,6],[6,7],[6,8],[6,9],
          [5,6],[5,7],[5,8],[5,9],
          [4,7],[4,8],[4,9],
          [3,8],[3,9],
          [2,9]
        ];
        
        carryAddPairs.forEach(([a, b]) => {
          pool.push({q: `${a} + ${b}`, a: a + b});
        });
        
        // ë°›ì•„ë‚´ë¦¼ ëº„ì…ˆ
        const borrowSubPairs = [
          [12,3],[12,4],[12,5],[12,6],[12,7],[12,8],[12,9],
          [13,4],[13,5],[13,6],[13,7],[13,8],[13,9],
          [14,5],[14,6],[14,7],[14,8],[14,9],
          [15,6],[15,7],[15,8],[15,9],
          [16,7],[16,8],[16,9],
          [17,8],[17,9],
          [18,9]
        ];
        
        borrowSubPairs.forEach(([a, b]) => {
          pool.push({q: `${a} - ${b}`, a: a - b});
        });
        
        // í•œ ìë¦¬ ê³±ì…ˆ
        const multiplyPairs = [
          [2,2],[2,3],[2,4],[2,5],[2,6],[2,7],[2,8],[2,9],
          [3,3],[3,4],[3,5],[3,6],[3,7],[3,8],[3,9],
          [4,4],[4,5],[4,6],[4,7],[4,8],[4,9],
          [5,5],[5,6],[5,7],[5,8],[5,9],
          [6,6],[6,7],[6,8],[6,9],
          [7,7],[7,8],[7,9],
          [8,8],[8,9],
          [9,9]
        ];
        
        multiplyPairs.forEach(([a, b]) => {
          pool.push({q: `${a} Ã— ${b}`, a: a * b});
        });
        
      } else if (age >= 9 && age <= 10) {
        // 9-10ì„¸: ë‘ ìë¦¬ ì‚¬ì¹™ì—°ì‚°, êµ¬êµ¬ë‹¨
        
        // ë‘ ìë¦¬ ë§ì…ˆ
        const twoDigitAdd = [
          [25,17],[34,28],[46,35],[57,24],[38,46],[29,33],[47,25],[56,38],
          [23,19],[35,27],[48,36],[59,25],[37,44],[28,35],[49,26],[58,37],
          [26,18],[33,29],[45,37],[54,28],[39,43],[27,34],[44,29],[55,36]
        ];
        
        twoDigitAdd.forEach(([a, b]) => {
          pool.push({q: `${a} + ${b}`, a: a + b});
        });
        
        // ë‘ ìë¦¬ ëº„ì…ˆ
        const twoDigitSub = [
          [52,25],[63,37],[74,48],[85,59],[61,34],[72,45],[83,56],[94,67],
          [53,26],[64,38],[75,49],[86,58],[62,35],[73,46],[84,57],[95,68],
          [54,27],[65,39],[76,47],[87,56],[63,36],[74,47],[85,58],[96,69]
        ];
        
        twoDigitSub.forEach(([a, b]) => {
          pool.push({q: `${a} - ${b}`, a: a - b});
        });
        
        // êµ¬êµ¬ë‹¨
        const multiplication = [
          [6,7],[7,8],[8,9],[6,8],[7,9],[6,9],[7,7],[8,8],[9,9],
          [4,6],[4,7],[4,8],[4,9],[5,6],[5,7],[5,8],[5,9],
          [3,6],[3,7],[3,8],[3,9],[2,6],[2,7],[2,8],[2,9]
        ];
        
        multiplication.forEach(([a, b]) => {
          pool.push({q: `${a} Ã— ${b}`, a: a * b});
        });
        
        // ê¸°ë³¸ ë‚˜ëˆ—ì…ˆ
        const division = [
          [24,3],[24,4],[24,6],[24,8],[28,4],[28,7],[32,4],[32,8],
          [35,5],[35,7],[42,6],[42,7],[45,5],[45,9],[48,6],[48,8],
          [36,6],[36,9],[40,5],[40,8],[54,6],[54,9],[56,7],[56,8]
        ];
        
        division.forEach(([a, b]) => {
          pool.push({q: `${a} Ã· ${b}`, a: a / b});
        });
        
      } else {
        // 11-13ì„¸: ì„¸ ìë¦¬ ìˆ˜, ë³µí•© ê³„ì‚°
        
        // ì„¸ ìë¦¬ ë§ì…ˆ
        const threeDigitAdd = [
          [156,278],[249,167],[378,245],[467,356],[189,234],[295,378],[346,289],[457,168],
          [234,189],[345,267],[456,378],[567,234],[178,345],[289,456],[356,234],[467,178]
        ];
        
        threeDigitAdd.forEach(([a, b]) => {
          pool.push({q: `${a} + ${b}`, a: a + b});
        });
        
        // ì„¸ ìë¦¬ ëº„ì…ˆ
        const threeDigitSub = [
          [456,189],[523,267],[634,278],[745,389],[512,145],[623,256],[734,367],[845,478],
          [567,234],[678,345],[789,456],[654,287],[765,398],[876,234],[543,176],[632,245]
        ];
        
        threeDigitSub.forEach(([a, b]) => {
          pool.push({q: `${a} - ${b}`, a: a - b});
        });
        
        // ë‘ ìë¦¬Ã—í•œ ìë¦¬
        const twoByOne = [
          [23,4],[34,5],[45,6],[56,7],[67,8],[78,9],[12,8],[13,9],
          [24,5],[35,6],[46,7],[57,8],[68,9],[79,4],[21,7],[32,8]
        ];
        
        twoByOne.forEach(([a, b]) => {
          pool.push({q: `${a} Ã— ${b}`, a: a * b});
        });
        
        // ë‘ ìë¦¬Ã·í•œ ìë¦¬
        const twoByOneDiv = [
          [84,6],[96,8],[75,5],[91,7],[88,4],[92,4],[87,3],[95,5],
          [72,6],[81,9],[64,8],[56,7],[48,6],[63,9],[54,6],[42,7]
        ];
        
        twoByOneDiv.forEach(([a, b]) => {
          if (a % b === 0) {
            pool.push({q: `${a} Ã· ${b}`, a: a / b});
          }
        });
        
        // ë³µí•©ê³„ì‚°
        const complexProblems = [
          {q: '(12 + 25) Ã— 3', a: (12 + 25) * 3},
          {q: '4 Ã— (18 + 7)', a: 4 * (18 + 7)},
          {q: '(145 - 67) + 35', a: (145 - 67) + 35},
          {q: '28 + 4 Ã— 6', a: 28 + 4 * 6},
          {q: '5 Ã— 16 - 23', a: 5 * 16 - 23},
          {q: '72 Ã· 6 + 19', a: 72 / 6 + 19},
          {q: '(23 + 17) Ã— 2', a: (23 + 17) * 2},
          {q: '6 Ã— (15 + 9)', a: 6 * (15 + 9)},
          {q: '(234 - 89) + 56', a: (234 - 89) + 56},
          {q: '36 + 7 Ã— 8', a: 36 + 7 * 8},
          {q: '9 Ã— 12 - 34', a: 9 * 12 - 34},
          {q: '84 Ã· 7 + 25', a: 84 / 7 + 25}
        ];
        
        complexProblems.forEach(problem => {
          pool.push(problem);
        });
      }
      
      return pool;
    }

    // ë‚˜ì´ë³„ ë¬¸ì œ ìƒì„± í•¨ìˆ˜ (ì™„ì „ ì¤‘ë³µ ë°©ì§€)
    function makeQuestions(age) {
      const pool = generateQuestionPool(age);
      
      // ì¤‘ë³µ ì œê±°: ë¬¸ì œ í…ìŠ¤íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¤‘ë³µ ì œê±°
      const uniquePool = [];
      const seenQuestions = new Set();
      
      for (const problem of pool) {
        if (!seenQuestions.has(problem.q)) {
          seenQuestions.add(problem.q);
          uniquePool.push(problem);
        }
      }
      
      console.log(`ë‚˜ì´ ${age}ì„¸: ì´ ${uniquePool.length}ê°œì˜ ê³ ìœ  ë¬¸ì œ ìƒì„±`);
      
      // ì¶©ë¶„í•œ ë¬¸ì œê°€ ì—†ìœ¼ë©´ ì¶”ê°€ ìƒì„±
      if (uniquePool.length < 20) {
        console.log(`ë¬¸ì œ ë¶€ì¡± (${uniquePool.length}ê°œ) - ì¶”ê°€ ìƒì„± ì¤‘...`);
        const additionalProblems = generateAdditionalQuestions(age, 20 - uniquePool.length, seenQuestions);
        uniquePool.push(...additionalProblems);
      }
      
      // ì„ê¸°
      const shuffled = shuffleArray(uniquePool);
      
      // ì •í™•íˆ 20ê°œ ì„ íƒ (ì¤‘ë³µ ì—†ìŒ ë³´ì¥)
      const selected = shuffled.slice(0, 20);
      
      // ìµœì¢… ì¤‘ë³µ ê²€ì‚¬ (ì•ˆì „ì¥ì¹˜)
      const finalCheck = new Set();
      const finalQuestions = [];
      
      for (const problem of selected) {
        if (!finalCheck.has(problem.q)) {
          finalCheck.add(problem.q);
          finalQuestions.push(problem);
        }
      }
      
      console.log(`ìµœì¢… ì„ íƒëœ ë¬¸ì œ: ${finalQuestions.length}ê°œ (ì¤‘ë³µ ì—†ìŒ)`);
      
      return finalQuestions;
    }

    // ì¶”ê°€ ë¬¸ì œ ìƒì„± í•¨ìˆ˜ (ë¶€ì¡±í•œ ê²½ìš°)
    function generateAdditionalQuestions(age, needed, existingQuestions) {
      const additional = [];
      let attempts = 0;
      const maxAttempts = 1000; // ë¬´í•œë£¨í”„ ë°©ì§€
      
      while (additional.length < needed && attempts < maxAttempts) {
        attempts++;
        let q = '', a = 0;
        
        // ë‚˜ì´ë³„ ì¶”ê°€ ë¬¸ì œ ìƒì„± ë¡œì§
        if (age === 3) {
          if (Math.random() < 0.5) {
            const x = randInt(1, 3);
            const y = randInt(1, 5 - x);
            q = `${x} + ${y}`;
            a = x + y;
          } else {
            const x = randInt(2, 5);
            const y = randInt(1, x - 1);
            q = `${x} - ${y}`;
            a = x - y;
          }
        } else if (age === 4) {
          if (Math.random() < 0.5) {
            const x = randInt(1, 4);
            const y = randInt(1, 5 - x);
            q = `${x} + ${y}`;
            a = x + y;
          } else {
            const x = randInt(2, 5);
            const y = randInt(1, x);
            q = `${x} - ${y}`;
            a = x - y;
          }
        } else if (age >= 5 && age <= 6) {
          if (Math.random() < 0.5) {
            const x = randInt(1, 9);
            const y = randInt(1, 10 - x);
            q = `${x} + ${y}`;
            a = x + y;
          } else {
            const x = randInt(2, 10);
            const y = randInt(1, x);
            q = `${x} - ${y}`;
            a = x - y;
          }
        } else if (age >= 7 && age <= 8) {
          const t = Math.random();
          if (t < 0.4) {
            // ë°›ì•„ì˜¬ë¦¼ ë§ì…ˆ
            const x = randInt(6, 9);
            const y = randInt(10 - x + 1, 9);
            q = `${x} + ${y}`;
            a = x + y;
          } else if (t < 0.7) {
            // ë°›ì•„ë‚´ë¦¼ ëº„ì…ˆ
            const x = randInt(11, 18);
            const y = randInt(Math.max(2, x - 10), Math.min(9, x - 1));
            q = `${x} - ${y}`;
            a = x - y;
          } else {
            // ê³±ì…ˆ
            const x = randInt(2, 9);
            const y = randInt(2, 9);
            q = `${x} Ã— ${y}`;
            a = x * y;
          }
        } else if (age >= 9 && age <= 10) {
          const t = Math.random();
          if (t < 0.25) {
            // ë‘ ìë¦¬ ë§ì…ˆ
            const x = randInt(12, 89);
            const y = randInt(12, 89);
            q = `${x} + ${y}`;
            a = x + y;
          } else if (t < 0.5) {
            // ë‘ ìë¦¬ ëº„ì…ˆ
            const x = randInt(25, 99);
            const y = randInt(12, x - 1);
            q = `${x} - ${y}`;
            a = x - y;
          } else if (t < 0.75) {
            // êµ¬êµ¬ë‹¨
            const x = randInt(2, 9);
            const y = randInt(2, 9);
            q = `${x} Ã— ${y}`;
            a = x * y;
          } else {
            // ë‚˜ëˆ—ì…ˆ
            const y = randInt(2, 9);
            const result = randInt(2, 12);
            const x = y * result;
            q = `${x} Ã· ${y}`;
            a = result;
          }
        } else {
          // 11-13ì„¸
          const t = Math.random();
          if (t < 0.2) {
            // ì„¸ ìë¦¬ ë§ì…ˆ
            const x = randInt(100, 899);
            const y = randInt(100, 899);
            q = `${x} + ${y}`;
            a = x + y;
          } else if (t < 0.4) {
            // ì„¸ ìë¦¬ ëº„ì…ˆ
            const x = randInt(200, 999);
            const y = randInt(100, x - 1);
            q = `${x} - ${y}`;
            a = x - y;
          } else if (t < 0.6) {
            // ë‘ ìë¦¬Ã—í•œ ìë¦¬
            const x = randInt(12, 99);
            const y = randInt(2, 9);
            q = `${x} Ã— ${y}`;
            a = x * y;
          } else if (t < 0.8) {
            // ë‘ ìë¦¬Ã·í•œ ìë¦¬
            const y = randInt(2, 9);
            const result = randInt(5, 15);
            const x = y * result;
            q = `${x} Ã· ${y}`;
            a = result;
          } else {
            // ê°„ë‹¨í•œ ë³µí•©ê³„ì‚°
            const x = randInt(5, 25);
            const y = randInt(5, 25);
            const z = randInt(2, 5);
            if (Math.random() < 0.5) {
              q = `${x} + ${y} Ã— ${z}`;
              a = x + (y * z);
            } else {
              q = `${x} Ã— ${z} + ${y}`;
              a = (x * z) + y;
            }
          }
        }
        
        // ì¤‘ë³µ ê²€ì‚¬
        if (!existingQuestions.has(q)) {
          existingQuestions.add(q);
          additional.push({q: q, a: a});
        }
      }
      
      console.log(`ì¶”ê°€ ìƒì„±ëœ ë¬¸ì œ: ${additional.length}ê°œ`);
      return additional;
    }

    // ë¬¸ì œ ìœ í˜•ë³„ ë§ì¶¤ ì„¤ëª… í•¨ìˆ˜
    function getMathTipForQuestion(question, answer, age) {
      const q = question.toLowerCase();
      
      if (age <= 4) {
        // 3-4ì„¸: ê¸°ì´ˆ ì„¤ëª…
        if (q.includes('+')) {
          const parts = q.split('+');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          return `ğŸ§¸ <strong>ë”í•˜ê¸° ì„¤ëª…:</strong><br>
          ${question}ë¥¼ ì†ê°€ë½ìœ¼ë¡œ ì„¸ì–´ë³´ì„¸ìš”!<br>
          ì™¼ì†ìœ¼ë¡œ ${a}ê°œ, ì˜¤ë¥¸ì†ìœ¼ë¡œ ${b}ê°œë¥¼ í´ê³ <br>
          ëª¨ë‘ ì„¸ì–´ë³´ë©´ ${answer}ê°œê°€ ë‚˜ì™€ìš”!<br>
          ğŸ’¡ ë¸”ë¡ì´ë‚˜ ì¥ë‚œê°ìœ¼ë¡œë„ í•´ë³´ì„¸ìš”!`;
        } else if (q.includes('-')) {
          const parts = q.split('-');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          return `ğŸ <strong>ë¹¼ê¸° ì„¤ëª…:</strong><br>
          ${a}ê°œì—ì„œ ${b}ê°œë¥¼ ë¹¼ëŠ” ê±°ì˜ˆìš”!<br>
          ${a}ê°œì˜ ì‚¬íƒ•ì´ ìˆëŠ”ë° ${b}ê°œë¥¼ ë¨¹ìœ¼ë©´<br>
          ${answer}ê°œê°€ ë‚¨ì•„ìš”!<br>
          ğŸ’¡ í•˜ë‚˜ì”© ì—†ì• ë©´ì„œ ì„¸ì–´ë³´ì„¸ìš”!`;
        }
      } else if (age >= 5 && age <= 6) {
        // 5-6ì„¸: 10 ì´í•˜ ì—°ì‚°
        if (q.includes('+')) {
          const parts = q.split('+');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          if (answer === 10) {
            return `ğŸ¯ <strong>10 ë§Œë“¤ê¸°:</strong><br>
            ${a} + ${b} = 10<br>
            10ì„ ë§Œë“œëŠ” ì§ê¿ ìˆ«ìë“¤ì´ì—ìš”!<br>
            ${a}ê³¼ ${b}ëŠ” 10ì˜ ì¢‹ì€ ì¹œêµ¬ë“¤ì´ëë‹ˆë‹¤.<br>
            ğŸ’¡ 10ì˜ ì§ê¿ë“¤ì„ ì™¸ìš°ë©´ ê³„ì‚°ì´ ë¹¨ë¼ì ¸ìš”!`;
          } else {
            return `âš¡ <strong>ë§ì…ˆ ë¹„ë²•:</strong><br>
            ${a} + ${b} = ${answer}<br>
            í° ìˆ˜ ${Math.max(a,b)}ë¶€í„° ì„¸ê³ , ì‘ì€ ìˆ˜ ${Math.min(a,b)}ë§Œí¼ ë” ì„¸ì–´ë³´ì„¸ìš”!<br>
            ${Math.max(a,b)}... ${Math.max(a,b)+1}, ${Math.max(a,b)+2}... = ${answer}<br>
            ğŸ’¡ í° ìˆ˜ë¶€í„° ì‹œì‘í•˜ë©´ ë” ì‰¬ì›Œìš”!`;
          }
        } else if (q.includes('-')) {
          const parts = q.split('-');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `ğŸ”„ <strong>ëº„ì…ˆ ë¹„ë²•:</strong><br>
          ${a} - ${b} = ${answer}<br>
          ${a}ì—ì„œ ${b}ë¥¼ ë¹¼ëŠ” ë°©ë²•:<br>
          ${a}ë¶€í„° ê±°ê¾¸ë¡œ ì„¸ì–´ë³´ì„¸ìš”: ${a}ì—ì„œ ${b}ë§Œí¼ ë’¤ë¡œ!<br>
          ğŸ’¡ ë˜ëŠ” "${b} + ? = ${a}"ë¡œ ìƒê°í•´ë³´ì„¸ìš”!`;
        }
      } else if (age >= 7 && age <= 8) {
        // 7-8ì„¸: ë°›ì•„ì˜¬ë¦¼/ë°›ì•„ë‚´ë¦¼, ê³±ì…ˆ
        if (q.includes('+')) {
          const parts = q.split('+');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          if (answer > 10) {
            return `ğŸ¯ <strong>ë°›ì•„ì˜¬ë¦¼ ë§ˆìŠ¤í„°:</strong><br>
            ${a} + ${b} = ${answer}<br>
            ì¼ì˜ ìë¦¬: ${a%10} + ${b%10} = ${(a%10)+(b%10)} â†’ ${((a%10)+(b%10)) >= 10 ? 'ë°›ì•„ì˜¬ë¦¼ 1' : 'ê·¸ëŒ€ë¡œ'}<br>
            ì‹­ì˜ ìë¦¬: ${Math.floor(a/10)} + ${Math.floor(b/10)} ${((a%10)+(b%10)) >= 10 ? '+ 1' : ''} = ${Math.floor(answer/10)}<br>
            ğŸ’¡ ì¼ì˜ ìë¦¬ë¶€í„° ì°¨ê·¼ì°¨ê·¼ ê³„ì‚°í•˜ì„¸ìš”!`;
          } else {
            return `âš¡ <strong>í•œ ìë¦¬ ë§ì…ˆ:</strong><br>
            ${a} + ${b} = ${answer}<br>
            ê°„ë‹¨í•œ ë§ì…ˆì´ì—ìš”!<br>
            ğŸ’¡ 10ì˜ ë³´ìˆ˜ë¥¼ í™œìš©í•˜ë©´ ë” ë¹¨ë¼ì ¸ìš”!`;
          }
        } else if (q.includes('-')) {
          const parts = q.split('-');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          if (a > 10 && b > (a%10)) {
            return `ğŸ­ <strong>ë°›ì•„ë‚´ë¦¼ ë¹„ë²•:</strong><br>
            ${a} - ${b} = ${answer}<br>
            ì¼ì˜ ìë¦¬ê°€ ë¶€ì¡±í•´ì„œ ì‹­ì˜ ìë¦¬ì—ì„œ 10ì„ ë¹Œë ¤ì™”ì–´ìš”!<br>
            ${a} = ${Math.floor(a/10)-1}${(a%10)+10} ë¡œ ë°”ê¾¸ê³ <br>
            ${(a%10)+10} - ${b} = ${((a%10)+10)-b}, ì‹­ì˜ ìë¦¬ëŠ” ${Math.floor(a/10)-1}<br>
            ğŸ’¡ ì‹­ì˜ ìë¦¬ì—ì„œ 1ì„ ë¹Œë ¤ì„œ ì¼ì˜ ìë¦¬ì— 10ì„ ë”í•´ìš”!`;
          } else {
            return `ğŸ”„ <strong>ê°„ë‹¨í•œ ëº„ì…ˆ:</strong><br>
            ${a} - ${b} = ${answer}<br>
            ${a}ì—ì„œ ${b}ë§Œí¼ ë¹¼ë©´ ${answer}ê°€ ë‚¨ì•„ìš”!<br>
            ğŸ’¡ ê±°ê¾¸ë¡œ ìƒê°í•˜ë©´ ${answer} + ${b} = ${a}ì˜ˆìš”!`;
          }
        } else if (q.includes('Ã—')) {
          const parts = q.split('Ã—');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `ğŸš€ <strong>ê³±ì…ˆ ì„¤ëª…:</strong><br>
          ${a} Ã— ${b} = ${answer}<br>
          ${a}ì„ ${b}ë²ˆ ë”í•˜ëŠ” ê±°ì˜ˆìš”!<br>
          ${Array.from({length: b}, (_, i) => a).join(' + ')} = ${answer}<br>
          ğŸ’¡ êµ¬êµ¬ë‹¨ì„ ì™¸ìš°ë©´ ë°”ë¡œë°”ë¡œ ê³„ì‚°í•  ìˆ˜ ìˆì–´ìš”!`;
        }
      } else if (age >= 9 && age <= 10) {
        // 9-10ì„¸: êµ¬êµ¬ë‹¨, ë‘ ìë¦¬ ì‚¬ì¹™ì—°ì‚°
        if (q.includes('+')) {
          const parts = q.split('+');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `ğŸ”„ <strong>ë‘ ìë¦¬ ë§ì…ˆ:</strong><br>
          ${a} + ${b} = ${answer}<br>
          ì‹­ì˜ ìë¦¬: ${Math.floor(a/10)} + ${Math.floor(b/10)} = ${Math.floor(a/10) + Math.floor(b/10)}<br>
          ì¼ì˜ ìë¦¬: ${a%10} + ${b%10} = ${(a%10) + (b%10)} ${(a%10) + (b%10) >= 10 ? 'â†’ ë°›ì•„ì˜¬ë¦¼!' : ''}<br>
          ğŸ’¡ ìë¦¬ë³„ë¡œ ë‚˜ëˆ„ì–´ì„œ ê³„ì‚°í•˜ë©´ ì‰¬ì›Œìš”!`;
        } else if (q.includes('-')) {
          const parts = q.split('-');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `ğŸ”„ <strong>ë‘ ìë¦¬ ëº„ì…ˆ:</strong><br>
          ${a} - ${b} = ${answer}<br>
          ì‹­ì˜ ìë¦¬: ${Math.floor(a/10)} - ${Math.floor(b/10)} = ${Math.floor(a/10) - Math.floor(b/10)}<br>
          ì¼ì˜ ìë¦¬: ${a%10} - ${b%10} = ${(a%10) - (b%10)} ${(a%10) < (b%10) ? 'â†’ ë°›ì•„ë‚´ë¦¼!' : ''}<br>
          ğŸ’¡ ì¼ì˜ ìë¦¬ê°€ ë¶€ì¡±í•˜ë©´ ì‹­ì˜ ìë¦¬ì—ì„œ ë¹Œë ¤ì˜¤ì„¸ìš”!`;
        } else if (q.includes('Ã—')) {
          const parts = q.split('Ã—');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `â­ <strong>êµ¬êµ¬ë‹¨ í™œìš©:</strong><br>
          ${a} Ã— ${b} = ${answer}<br>
          ${a}ë‹¨: ${a} Ã— ${b} = ${answer}<br>
          ë˜ëŠ” ${b}ë‹¨: ${b} Ã— ${a} = ${answer}<br>
          ğŸ’¡ êµ¬êµ¬ë‹¨ì„ ì™¸ìš°ë©´ ê³±ì…ˆì´ ì‰¬ì›Œì ¸ìš”!`;
        } else if (q.includes('Ã·')) {
          const parts = q.split('Ã·');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `ğŸ”„ <strong>ë‚˜ëˆ—ì…ˆ = ê±°ê¾¸ë¡œ ê³±ì…ˆ:</strong><br>
          ${a} Ã· ${b} = ${answer}<br>
          "${b} Ã— ? = ${a}"ë¥¼ ìƒê°í•´ë³´ì„¸ìš”!<br>
          ${b} Ã— ${answer} = ${a} âœ“<br>
          ğŸ’¡ ë‚˜ëˆ—ì…ˆì€ ê³±ì…ˆí‘œë¥¼ ê±°ê¾¸ë¡œ ì‚¬ìš©í•˜ëŠ” ê±°ì˜ˆìš”!`;
        }
      } else {
        // 11-13ì„¸: ë³µí•© ê³„ì‚°, ê³ ê¸‰ ì—°ì‚°
        if (q.includes('(') && q.includes(')')) {
          return `ğŸ­ <strong>ë³µí•©ê³„ì‚° ìˆœì„œ:</strong><br>
          ${question} = ${answer}<br>
          1ë‹¨ê³„: ê´„í˜¸ ì•ˆë¶€í„° ê³„ì‚°í•˜ì„¸ìš”!<br>
          2ë‹¨ê³„: ê³±ì…ˆê³¼ ë‚˜ëˆ—ì…ˆì„ ë¨¼ì €<br>
          3ë‹¨ê³„: ë§ì…ˆê³¼ ëº„ì…ˆì„ ë‚˜ì¤‘ì—<br>
          ğŸ’¡ ê³„ì‚° ìˆœì„œ: ( ) â†’ Ã— Ã· â†’ + -`;
        } else if (q.includes('Ã—') && (q.includes('+') || q.includes('-'))) {
          return `ğŸ§© <strong>ì‚¬ì¹™í˜¼í•©ì—°ì‚°:</strong><br>
          ${question} = ${answer}<br>
          ê³±ì…ˆì„ ë¨¼ì € ê³„ì‚°í•˜ê³ , ê·¸ ë‹¤ìŒì— ë§ì…ˆ/ëº„ì…ˆ!<br>
          ìˆœì„œë¥¼ ì§€í‚¤ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”.<br>
          ğŸ’¡ ê³±ì…ˆÃ—ë‚˜ëˆ—ì…ˆì´ ë§ì…ˆ+ëº„ì…ˆë³´ë‹¤ ìš°ì„ ì´ì—ìš”!`;
        } else if (q.includes('+')) {
          const parts = q.split('+');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `ğŸ”„ <strong>ì„¸ ìë¦¬ ë§ì…ˆ:</strong><br>
          ${a} + ${b} = ${answer}<br>
          ë°±ì˜ ìë¦¬ + ì‹­ì˜ ìë¦¬ + ì¼ì˜ ìë¦¬ë¡œ ë‚˜ëˆ„ì–´ ê³„ì‚°!<br>
          ê° ìë¦¬ë³„ë¡œ ë”í•˜ê³  ë°›ì•„ì˜¬ë¦¼ì„ ì²˜ë¦¬í•˜ì„¸ìš”.<br>
          ğŸ’¡ í° ìˆ˜ë„ ìë¦¬ë³„ë¡œ ë‚˜ëˆ„ë©´ ì‰¬ì›Œì ¸ìš”!`;
        } else if (q.includes('-')) {
          const parts = q.split('-');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `ğŸ”„ <strong>ì„¸ ìë¦¬ ëº„ì…ˆ:</strong><br>
          ${a} - ${b} = ${answer}<br>
          ê° ìë¦¬ë³„ë¡œ ë¹¼ê³ , ë¶€ì¡±í•˜ë©´ ìœ—ìë¦¬ì—ì„œ ë¹Œë ¤ì˜¤ì„¸ìš”!<br>
          ê²€ì‚°: ${answer} + ${b} = ${a} âœ“<br>
          ğŸ’¡ ëº„ì…ˆ í›„ì—ëŠ” ë§ì…ˆìœ¼ë¡œ ê²€ì‚°í•´ë³´ì„¸ìš”!`;
        } else if (q.includes('Ã—')) {
          const parts = q.split('Ã—');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `ğŸ¯ <strong>í° ìˆ˜ ê³±ì…ˆ:</strong><br>
          ${a} Ã— ${b} = ${answer}<br>
          ë¶„í•´í•´ì„œ ê³„ì‚°í•˜ë©´ ì‰¬ì›Œìš”!<br>
          ì˜ˆ: 23 Ã— 4 = (20 + 3) Ã— 4 = 20Ã—4 + 3Ã—4 = 80 + 12 = 92<br>
          ğŸ’¡ í° ìˆ˜ë¥¼ ì‹­ì˜ ìë¦¬ì™€ ì¼ì˜ ìë¦¬ë¡œ ë‚˜ëˆ„ì–´ ê³„ì‚°í•˜ì„¸ìš”!`;
        } else if (q.includes('Ã·')) {
          const parts = q.split('Ã·');
          const a = parseInt(parts[0].trim());
          const b = parseInt(parts[1].split('=')[0].trim());
          
          return `ğŸ“¦ <strong>í° ìˆ˜ ë‚˜ëˆ—ì…ˆ:</strong><br>
          ${a} Ã· ${b} = ${answer}<br>
          ë‚˜ëˆ„ì–´ì§€ëŠ” ìˆ˜ë¥¼ ì‘ì€ ë‹¨ìœ„ë¡œ ìª¼ê°œì„œ ê³„ì‚°í•˜ê±°ë‚˜<br>
          "${b} Ã— ? = ${a}"ë¡œ ìƒê°í•´ë³´ì„¸ìš”!<br>
          ğŸ’¡ ëª« Ã— ë‚˜ëˆ„ëŠ”ìˆ˜ + ë‚˜ë¨¸ì§€ = ë‚˜ëˆ„ì–´ì§€ëŠ”ìˆ˜ë¡œ ê²€ì‚°í•˜ì„¸ìš”!`;
        }
      }
      
      // ê¸°ë³¸ ì„¤ëª… (ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš°)
      return `ğŸ’¡ <strong>ë¬¸ì œ í•´ì„¤:</strong><br>
      ${question} = ${answer}<br>
      ì´ ë¬¸ì œì˜ ì •ë‹µì€ ${answer}ì…ë‹ˆë‹¤.<br>
      ì²œì²œíˆ ë‹¤ì‹œ ê³„ì‚°í•´ë³´ì„¸ìš”!<br>
      ğŸ’ª í‹€ë ¤ë„ ê´œì°®ì•„ìš”. ì—°ìŠµí•˜ë©´ ëŠ˜ì–´ë‚˜ìš”!`;
    }

    // ì˜¤í”„ë‹ ë¹„ë””ì˜¤ ê´€ë ¨ ìš”ì†Œë“¤
    const openingContainer = document.getElementById('openingVideo');
    const gameContainer = document.getElementById('gameContainer');
    const skipButton = document.getElementById('skipButton');
    const openingVideoPlayer = document.getElementById('openingVideoPlayer');
    let videoTimeoutId = null;
    let gameStarted = false;

    // ê²Œì„ í™”ë©´ í‘œì‹œ í•¨ìˆ˜
    function showGame() {
      if (gameStarted) return; // ì´ë¯¸ ê²Œì„ì´ ì‹œì‘ëœ ê²½ìš° ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
      gameStarted = true;
      
      console.log('ê²Œì„ ì‹œì‘');
      openingContainer.style.display = 'none';
      gameContainer.style.display = 'flex';
      startBackgroundMusic();
      
      // íƒ€ì„ì•„ì›ƒ ì •ë¦¬
      if (videoTimeoutId) {
        clearTimeout(videoTimeoutId);
        videoTimeoutId = null;
      }
    }

    // ì˜¤í”„ë‹ ë¹„ë””ì˜¤ ì¢…ë£Œ ì‹œ ìë™ìœ¼ë¡œ ê²Œì„ ì‹œì‘
    openingVideoPlayer.addEventListener('ended', function() {
      console.log('ë¹„ë””ì˜¤ ì¬ìƒ ì™„ë£Œ - ê²Œì„ ì‹œì‘');
      showGame();
    });

    // ê±´ë„ˆë›°ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ
    skipButton.addEventListener('click', function() {
      console.log('ê±´ë„ˆë›°ê¸° ë²„íŠ¼ í´ë¦­ë¨');
      openingVideoPlayer.pause();
      openingVideoPlayer.currentTime = 0;
      showGame();
    });

    // ì˜¤í”„ë‹ ë¹„ë””ì˜¤ ë¡œë“œ ì‹œ ë³¼ë¥¨ ì„¤ì •
    openingVideoPlayer.addEventListener('loadedmetadata', function() {
      console.log('ë¹„ë””ì˜¤ ë©”íƒ€ë°ì´í„° ë¡œë“œë¨, ê¸¸ì´:', openingVideoPlayer.duration + 'ì´ˆ');
      openingVideoPlayer.volume = 1.0;
      openingVideoPlayer.muted = false;
    });

    // ìë™ì¬ìƒ ì‹œë„
    function tryAutoplay() {
      if (gameStarted) return;
      
      openingVideoPlayer.play().then(() => {
        console.log('ë¹„ë””ì˜¤ ìë™ì¬ìƒ ì„±ê³µ');
        // ìë™ì¬ìƒ ì„±ê³µ ì‹œ íƒ€ì„ì•„ì›ƒ í•´ì œ
        if (videoTimeoutId) {
          clearTimeout(videoTimeoutId);
          videoTimeoutId = null;
        }
      }).catch(e => {
        console.log('ìë™ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤:', e);
        // ìë™ì¬ìƒì´ ì°¨ë‹¨ëœ ê²½ìš° í´ë¦­í•˜ì—¬ ì¬ìƒí•˜ë„ë¡ ì•ˆë‚´
        const playButton = document.createElement('button');
        playButton.textContent = 'â–¶ ì˜ìƒ ì¬ìƒí•˜ê¸°';
        playButton.style.cssText = `
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          padding: 20px 40px;
          font-size: 20px;
          background: #66b5f6;
          color: white;
          border: none;
          border-radius: 10px;
          cursor: pointer;
          z-index: 1002;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        `;
        playButton.onclick = function() {
          openingVideoPlayer.play().then(() => {
            playButton.remove();
            // ìˆ˜ë™ ì¬ìƒ ì„±ê³µ ì‹œ íƒ€ì„ì•„ì›ƒ í•´ì œ
            if (videoTimeoutId) {
              clearTimeout(videoTimeoutId);
              videoTimeoutId = null;
            }
          }).catch(err => {
            console.log('ìˆ˜ë™ ì¬ìƒë„ ì‹¤íŒ¨:', err);
            playButton.remove();
            showGame();
          });
        };
        openingContainer.appendChild(playButton);
      });
    }

    // ì˜¤í”„ë‹ ë¹„ë””ì˜¤ ì˜¤ë¥˜ ì‹œ ê²Œì„ ì‹œì‘
    openingVideoPlayer.addEventListener('error', function(e) {
      console.log('ë¹„ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:', e);
      setTimeout(() => {
        showGame();
      }, 1000);
    });

    // ë¹„ë””ì˜¤ íŒŒì¼ì´ ì—†ê±°ë‚˜ ë¡œë“œë˜ì§€ ì•Šì„ ê²½ìš°ì—ë§Œ íƒ€ì„ì•„ì›ƒ
    videoTimeoutId = setTimeout(() => {
      if (!gameStarted && openingContainer.style.display !== 'none') {
        console.log('ë¹„ë””ì˜¤ ë¡œë“œ ì‹œê°„ ì´ˆê³¼ - ê²Œì„ ì‹œì‘');
        showGame();
      }
    }, 10000); // 10ì´ˆë¡œ ì¦ê°€

    // ì¶•í•˜ ë©”ì‹œì§€ ëª¨ë‹¬ ê´€ë ¨
    const congratsModal = document.getElementById('congratsModal');
    const giftButton = document.getElementById('giftButton');
    const congratsSound = document.getElementById('congratsSound');
    const celebrationContainer = document.getElementById('celebrationVideo');
    const closeVideoBtn = document.getElementById('closeVideoBtn');
    const bgMusic = document.getElementById('bgMusic');

    // ê²Œì„ ì‹œì‘ ì‹œ ë°°ê²½ìŒì•… ì¬ìƒ
    function startBackgroundMusic() {
      if (!bgMusicStarted) {
        bgMusic.volume = 0.4;
        bgMusic.play().catch(e => {
          console.log('ë°°ê²½ìŒì•… ìë™ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í›„ ì¬ìƒë©ë‹ˆë‹¤.');
        });
        bgMusicStarted = true;
      }
    }

    // ì¶•í•˜ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
    function showCongratsModal() {
      bgMusic.pause();
      congratsModal.style.display = 'flex';
      
      congratsSound.play().catch(e => {
        console.log('ë°•ìˆ˜ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e);
      });
    }

    // ì„ ë¬¼ë°›ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    giftButton.addEventListener('click', function() {
      congratsModal.style.display = 'none';
      playCelebrationVideo();
    });

    // ì¶•í•˜ ì˜ìƒ ì¬ìƒ í•¨ìˆ˜
    function playCelebrationVideo() {
      const randomIndex = Math.floor(Math.random() * celebrationVideos.length);
      const videoId = celebrationVideos[randomIndex];
      
      const celebrationIframe = document.getElementById('celebrationPlayer');
      celebrationIframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0&controls=1&modestbranding=1&rel=0&enablejsapi=1`;
      
      celebrationContainer.style.display = 'flex';
    }

    // ì¶•í•˜ ì˜ìƒ ë‹«ê¸°
    closeVideoBtn.addEventListener('click', function() {
      const celebrationIframe = document.getElementById('celebrationPlayer');
      celebrationIframe.src = '';
      celebrationContainer.style.display = 'none';
      bgMusic.play();
    });

    // ê²°ê³¼ ë©”ì‹œì§€ í•¨ìˆ˜
    function getResultMsg(rate) {
      if (rate >= 90) return 'ìš°ìˆ˜í•´ìš”! ìˆ˜í•™ì²œì¬! ğŸ‘‘ğŸ¦–';
      if (rate >= 80) return 'ì¡°ê¸ˆë§Œ ë” í•˜ë©´ 90%ë„ ê°€ëŠ¥í•´ìš”! í™”ì´íŒ…! ğŸŒˆ';
      return '70%ê°€ ë„˜ì„ ë•Œê¹Œì§€ ì¡°ê¸ˆ ë” ì—°ìŠµí•´ìš”! ì¬ë„ì „ Go! ğŸšğŸ‘‘';
    }

    // ì •ë‹µ í™•ì¸ í•¨ìˆ˜
    function checkAnswer() {
      const userAns = document.getElementById('answerInput').value.trim();
      const q = quiz.questions[quiz.current];
      
      if (userAns === "") { 
        document.getElementById('feedback').textContent = "ë‹µì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!"; 
        return; 
      }
      
      if (Number(userAns) === q.a) {
        // ì •ë‹µ ì²˜ë¦¬
        quiz.correct++;
        quiz.consecutiveCorrect++;
        quiz.consecutiveWrong = 0;
        
        let message;
        if (quiz.consecutiveCorrect >= 3) {
          message = consecutiveMessages[randInt(0, consecutiveMessages.length - 1)];
        } else if (q.a > 50 || (quiz.age >= 11 && q.q.includes('Ã—') && q.a > 100)) {
          message = hardCorrectMessages[randInt(0, hardCorrectMessages.length - 1)];
        } else {
          message = correctMessages[randInt(0, correctMessages.length - 1)];
        }
        
        document.getElementById('feedback').textContent = message;
        document.getElementById('feedback').style.color = '#28a745';
        
        // íš¨ê³¼ìŒ ì¬ìƒ
        if (!applauseCooldown) {
          const applauseSound = document.getElementById('applauseSound');
          applauseSound.currentTime = 0;
          applauseSound.play().catch(e => {
            console.log('íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:', e);
          });
          applauseCooldown = true;
          setTimeout(() => { applauseCooldown = false; }, 1500);
        }
        
        // ì •ë‹µ ì‹œ 1.2ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œ
        document.getElementById('submitAnswerBtn').textContent = 'ë‹¤ìŒ ë¬¸ì œ';
        document.getElementById('submitAnswerBtn').disabled = true;
        
        setTimeout(() => {
          goToNextQuestion();
        }, 1200);
        
      } else {
        // ì˜¤ë‹µ ì²˜ë¦¬
        quiz.consecutiveCorrect = 0;
        quiz.consecutiveWrong++;
        
        let message;
        if (quiz.consecutiveWrong >= 3) {
          message = consecutiveWrongMessages[randInt(0, consecutiveWrongMessages.length - 1)];
        } else {
          message = wrongMessages[randInt(0, wrongMessages.length - 1)];
        }
        
        document.getElementById('feedback').textContent = `${message} (ì •ë‹µ: ${q.a})`;
        document.getElementById('feedback').style.color = '#dc3545';
        
        // ìˆ˜í•™ íŒ í‘œì‹œ (ë¬¸ì œë³„ ë§ì¶¤ ì„¤ëª…)
        const customTip = getMathTipForQuestion(q.q, q.a, quiz.age);
        document.getElementById('mathTip').innerHTML = customTip;
        document.getElementById('mathTip').style.display = 'block';
        
        // ì˜¤ë‹µ ì‹œ ìˆ˜ë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ (ìë™ ë„˜ì–´ê°€ê¸° ì œê±°)
        document.getElementById('submitAnswerBtn').textContent = 'ë‹¤ìŒ ë¬¸ì œ';
        document.getElementById('submitAnswerBtn').disabled = false;
        
        // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë‹¤ìŒ ë¬¸ì œë¡œ ë³€ê²½
        const btn = document.getElementById('submitAnswerBtn');
        btn.removeEventListener('click', checkAnswer);
        btn.addEventListener('click', goToNextQuestion);
      }
    }

    // ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
    function goToNextQuestion() {
      quiz.current++;
      if (quiz.current >= 20) {
        finishQuiz();
      } else {
        showQuestion();
      }
    }

    // ê²Œì„ ì‹œì‘
    document.getElementById('startQuizBtn').onclick = function() {
      const age = parseInt(document.getElementById('ageSelect').value);
      if (!age || age < 3 || age > 13) { 
        alert('3~13ì„¸ ë‚˜ì´ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤!'); 
        return; 
      }
      
      quiz.age = age;
      quiz.questions = makeQuestions(age);
      quiz.current = 0;
      quiz.correct = 0;
      quiz.consecutiveCorrect = 0;
      quiz.consecutiveWrong = 0;
      
      document.getElementById('ageSection').style.display = 'none';
      document.getElementById('quizSection').style.display = 'block';
      document.getElementById('resultSection').style.display = 'none';
      showQuestion();
      
      // ë°°ê²½ìŒì•… ì‹œì‘
      startBackgroundMusic();
    };

    // ë¬¸ì œ í‘œì‹œ
    function showQuestion() {
      const qinfo = quiz.questions[quiz.current];
      document.getElementById('questionNum').textContent = `ë¬¸ì œ ${quiz.current + 1} / 20`;
      document.getElementById('questionText').textContent = qinfo.q + ' = ?';
      document.getElementById('answerInput').value = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('mathTip').style.display = 'none';
      document.getElementById('answerInput').focus();
      document.getElementById('submitAnswerBtn').textContent = 'ì •ë‹µ í™•ì¸';
      document.getElementById('submitAnswerBtn').disabled = false;
      
      // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì™„ì „íˆ ìƒˆë¡œ ì„¤ì •
      const btn = document.getElementById('submitAnswerBtn');
      // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ëª¨ë‘ ì œê±°
      btn.replaceWith(btn.cloneNode(true));
      // ìƒˆë¡œìš´ ë²„íŠ¼ ì°¸ì¡° ê°€ì ¸ì˜¤ê¸°
      const newBtn = document.getElementById('submitAnswerBtn');
      // ì •ë‹µ í™•ì¸ ì´ë²¤íŠ¸ ì¶”ê°€
      newBtn.addEventListener('click', checkAnswer);
    }

    // ì—”í„°í‚¤ ì²˜ë¦¬
    document.getElementById('answerInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const btn = document.getElementById('submitAnswerBtn');
        if (!btn.disabled) {
          btn.click();
        }
      }
    });

    // í€´ì¦ˆ ì™„ë£Œ
    function finishQuiz() {
      document.getElementById('quizSection').style.display = 'none';
      document.getElementById('resultSection').style.display = 'block';
      document.getElementById('correctCount').textContent = quiz.correct;
      document.getElementById('totalCount').textContent = '20';
      
      const rate = Math.round(quiz.correct / 20 * 100);
      document.getElementById('accuracy').textContent = rate;
      document.getElementById('resultMsg').textContent = getResultMsg(rate);
      document.getElementById('retryBtn').style.display = (rate < 70) ? 'inline-block' : 'none';
      
      // 90ì  ì´ìƒì´ë©´ 2ì´ˆ í›„ ì¶•í•˜ ë©”ì‹œì§€ ëª¨ë‹¬ í‘œì‹œ
      if (rate >= 90) {
        setTimeout(() => {
          showCongratsModal();
        }, 2000);
      }
    }

    // ì¬ë„ì „
    document.getElementById('retryBtn').onclick = function() {
      quiz.current = 0;
      quiz.correct = 0;
      quiz.consecutiveCorrect = 0;
      quiz.consecutiveWrong = 0;
      quiz.questions = makeQuestions(quiz.age);
      
      document.getElementById('ageSection').style.display = 'none';
      document.getElementById('quizSection').style.display = 'block';
      document.getElementById('resultSection').style.display = 'none';
      showQuestion();
    };

    // ì²˜ìŒìœ¼ë¡œ
    document.getElementById('restartBtn').onclick = function() {
      location.reload();
    };

    // ìŒì†Œê±° í† ê¸€
    document.getElementById('muteBtn').onclick = function() {
      isSoundOn = !isSoundOn;
      bgMusic.muted = !isSoundOn;
      this.textContent = isSoundOn ? 'ğŸ”Š' : 'ğŸ”‡';
    };

    // ì •ë‹µ í™•ì¸ ë²„íŠ¼ ì´ˆê¸° ì´ë²¤íŠ¸ (ê²Œì„ ì‹œì‘ ì‹œì—ë§Œ)
    document.addEventListener('DOMContentLoaded', function() {
      const initialBtn = document.getElementById('submitAnswerBtn');
      if (initialBtn) {
        initialBtn.addEventListener('click', checkAnswer);
      }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜¤í”„ë‹ ë¹„ë””ì˜¤ë¶€í„° ì‹œì‘
    window.addEventListener('load', function() {
      console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ì˜¤í”„ë‹ ë¹„ë””ì˜¤ ì‹œì‘');
      // ì˜¤í”„ë‹ ë¹„ë””ì˜¤ê°€ ë¨¼ì € í‘œì‹œë¨
      openingContainer.style.display = 'flex';
      gameContainer.style.display = 'none';
      
      // í˜ì´ì§€ ë¡œë“œ í›„ ìë™ì¬ìƒ ì‹œë„
      setTimeout(() => {
        tryAutoplay();
      }, 500);
    });

  </script>
</body>
</html>
